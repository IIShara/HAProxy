# HAProxy
```
global
    log         127.0.0.1 local2      # Необходимо установить /etc/rsyslog.conf плюс уровень ведения журнала и путь журнала для устройства local2
    chroot      /var/lib/haproxy
    pidfile     /var/run/haproxy.pid
    maxconn     4000                  # Это максимальное количество внешних подключений в предыдущем сегменте. При проксировании http нет большой проблемы с 1 ГБ свободной памяти, содержащей более 20000
    user        haproxy
    group       haproxy
    daemon
    stats socket /var/lib/haproxy/stats  # Включите динамический просмотр и управление файлами статуса haproxy
                                         # Кроме того, рекомендуется установить глобальный элемент проверки распространения, а процентное соотношение рекомендуется в диапазоне 2-5
defaults
    mode                    http         # 7 уровней прокси http и 4 уровня прокси tcp
    log                     global
    option                  httplog      # Записывать http-запрос, информацию о сеансе и т. Д. В журнал
    option                  dontlognull  # Не записывать пустые соединения в журнал
    option http-server-close             # Рекомендуется использовать http-server-close для динамических приложений на бэкэнде и http-keep-alive для статических приложений на бэкэнде
    option forwardfor       except 127.0.0.0/8  # haproxy добавит поле заголовка «X-Forwarded-For» в запрос, отправленный на бэкэнд
    option                  redispatch   # Когда бэкэнд не работает, так что haproxy не может пересылать запросы, несущие куки, в этот бэкэнд, перенаправить их другим бэкэндам
    timeout http-request    10s     # Это максимальное время ожидания, пока клиент отправит полный запрос, его следует установить короче, чтобы предотвратить атаки флуда, например, 2-3 секунды
                                    # haproxy всегда требует, чтобы запрос или ответ были обработаны и перенаправлены после отправки,
    timeout queue           1m      # Максимальная продолжительность запроса в очереди, 1 минута слишком велика. Установка 10 секунд - это немного долго, и клиент потеряет терпение, если ресурс не будет запрошен в течение 10 секунд.
    timeout connect         10s     # haproxy Максимальное время для установления соединения с сервером, равное 1 секунде, достаточно. Установление соединения в локальной сети обычно происходит мгновенно.
    timeout client          1m      # Период тайм-аута для поддержания незанятого соединения с клиентом может быть немного короче при высоком уровне параллелизма и может быть установлен на 10 секунд, чтобы разорвать соединение как можно скорее
    timeout server          1m      # Период тайм-аута для поддержания неактивного соединения с сервером, соединение устанавливается быстро в локальной сети, поэтому постарайтесь установить его как можно короче, особенно когда оно одновременное, например, 1-3 секунды.
    timeout http-keep-alive 10s     # Максимальное время поддержания длительного соединения с клиентом. Приоритет выше таймаута http-запроса выше таймаута клиента
    timeout check           10s     # Продолжительность времени от успешного установления соединения с внутренним сервером до окончательного завершения проверки (не включая время для установления соединения, только время, чтобы прочитать результат проверки),
                                    # Можно установить короче, например 1-2 секунды
    maxconn                 3000    # Максимальное количество соединений между сегментом по умолчанию и предыдущим, но не может превышать жесткое ограничение maxconn в глобальном
```
